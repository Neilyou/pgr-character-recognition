# 战双角色识别Web应用使用指南

## 📋 系统要求

- Python 3.7+
- PyTorch 2.0+
- Flask
- Pillow

## 🚀 快速开始

### 1. 安装依赖

确保已安装所有必要的Python包：

```bash
pip install flask torch torchvision pillow
```

或者使用现有的conda环境：

```bash
conda activate llava
```

### 2. 启动应用

运行以下命令启动Web服务器：

```bash
python recognition_app.py
```

你会看到类似的输出：

```
============================================================
战双角色识别系统
============================================================
正在加载模型...
使用设备: cpu
加载了 19 个类别
模型加载成功！
============================================================
✓ 系统启动成功！
访问地址: http://127.0.0.1:5000
按 Ctrl+C 停止服务器
============================================================
```

### 3. 访问应用

在浏览器中打开：

```
http://127.0.0.1:5000
```

## 📱 使用方法

### 上传图片

有两种方式上传图片：

1. **点击上传按钮**
   - 点击"选择图片"按钮
   - 从文件浏览器中选择图片
   - 支持 JPG、PNG、WEBP 格式
   - 最大文件大小：10MB

2. **拖拽上传**
   - 直接将图片文件拖拽到上传区域
   - 松开鼠标即可上传

### 识别角色

1. 上传图片后，会显示预览
2. 点击"开始识别"按钮
3. 等待识别完成（通常1-3秒）
4. 查看识别结果

### 识别结果

系统会显示前5个最可能的角色，包括：

- **排名**：按置信度从高到低排序
- **角色名称**：中文显示名称
- **置信度**：识别的可信程度（0-100%）
- **置信度条**：可视化显示
  - 绿色：高置信度（>80%）
  - 黄色：中等置信度（50-80%）
  - 红色：低置信度（<50%）

### 识别新图片

点击"识别新图片"按钮返回上传界面。

## 🎯 支持的角色

系统可以识别以下19个战双角色：

1. 21号
2. 阿尔法
3. 艾拉
4. 比安卡
5. 渡边
6. 卡列尼娜
7. 库洛姆
8. 里
9. 丽芙
10. 露娜
11. 罗塞塔
12. 露西亚
13. 诺安
14. 七实
15. 曲
16. 赛琳娜
17. 神威
18. 万事
19. 薇拉

## 📊 模型信息

- **模型架构**：ResNet18
- **训练数据**：709张图片
- **验证准确率**：80.98%
- **类别数量**：19个角色
- **输入尺寸**：224x224

## 🔧 API接口

### 识别接口

**端点**：`POST /api/recognize`

**请求**：
- Content-Type: multipart/form-data
- 参数：image (文件)

**响应**：
```json
{
  "success": true,
  "results": [
    {
      "class_name": "luxiya",
      "display_name": "露西亚",
      "confidence": 0.95
    },
    ...
  ],
  "total_classes": 19
}
```

### 模型信息接口

**端点**：`GET /api/model_info`

**响应**：
```json
{
  "model_name": "resnet18",
  "num_classes": 19,
  "best_accuracy": 0.8098,
  "num_epochs": 30,
  ...
}
```

## ⚠️ 注意事项

### 图片要求

1. **格式**：JPG、PNG、WEBP
2. **大小**：最大10MB
3. **内容**：清晰的角色图片
4. **建议**：
   - 角色占图片主要部分
   - 光线充足，清晰度高
   - 避免过度遮挡
   - 避免多个角色混杂

### 识别准确性

- **高置信度（>80%）**：结果非常可靠
- **中等置信度（50-80%）**：结果较可靠，建议参考其他结果
- **低置信度（<50%）**：结果不确定，可能识别错误

### 性能优化

1. **使用GPU**：
   - 如果有NVIDIA GPU，安装CUDA版本的PyTorch
   - 识别速度可提升5-10倍

2. **批量处理**：
   - 当前版本不支持批量上传
   - 如需批量处理，可以使用API接口编写脚本

## 🐛 常见问题

### Q: 启动时提示"No module named 'torch'"

A: 需要安装PyTorch：
```bash
conda activate llava
# 或
pip install torch torchvision
```

### Q: 识别速度很慢

A: 
- CPU模式下识别需要1-3秒
- 使用GPU可以加速
- 确保图片大小不要太大（建议<5MB）

### Q: 识别结果不准确

A: 可能的原因：
- 图片质量不好（模糊、遮挡）
- 角色不在训练数据中
- 图片中有多个角色
- 角色姿态或角度特殊

建议：
- 使用清晰的单角色图片
- 参考多个识别结果
- 查看置信度判断可靠性

### Q: 如何停止服务器

A: 在终端按 `Ctrl+C`

### Q: 如何更改端口

A: 修改 `recognition_app.py` 最后一行：
```python
app.run(debug=True, port=8000)  # 改为8000端口
```

## 📈 未来改进

计划中的功能：

1. **目标检测**：支持识别图片中的多个角色
2. **批量上传**：一次上传多张图片
3. **历史记录**：保存识别历史
4. **角色详情**：显示角色信息和图片
5. **模型更新**：支持在线更新模型
6. **移动端优化**：更好的移动设备体验

## 📞 技术支持

如有问题，请检查：

1. 模型文件是否存在（`models/best_model.pth`）
2. 类别文件是否存在（`models/class_names.json`）
3. 模板文件是否存在（`templates/character_recognition.html`）
4. Python依赖是否完整安装

---

**享受使用战双角色识别系统！** 🎮
